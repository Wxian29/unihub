### 第一部分：项目工程结构拆分

推荐采用 **Monorepo** 的管理方式，即将后端、前端代码都放在同一个 Git 仓库中，便于统一管理和协同开发。

**顶级目录结构：**

```
uni-hub/
├── backend/            # Django 后端项目
├── frontend/           # React 前端项目
├── docker-compose.yml  # Docker 编排文件，用于一键启动整个环境
├── .gitignore          # Git 忽略文件
└── README.md           # 项目说明文档
```

---

#### 1. 后端工程结构 (backend/)

后端遵循 Django 的最佳实践，按照功能模块（App）进行划分，这完全符合 PRD 中“服务组件化”的思路。未来如果需要转向微服务，每个 App 都可以相对独立地拆分出去。

```
backend/
├── Dockerfile              # 后端服务的 Docker 配置文件
├── manage.py               # Django 项目管理脚本
├── requirements.txt        # Python 依赖库
│
└── uni_hub_core/           # Django 项目核心配置
│   ├── __init__.py
│   ├── settings.py         # 项目配置（数据库、中间件等）
│   ├── urls.py             # 总路由
│   └── wsgi.py
│
├── apps/                   # 存放所有功能模块（App）的目录
│   ├── __init__.py
│   │
│   ├── users/              # 用户模块：注册、登录、认证、个人资料
│   │   ├── migrations/
│   │   ├── models.py       # 用户、个人资料模型
│   │   ├── serializers.py  # DRF 序列化器
│   │   ├── views.py        # 视图和 API 接口
│   │   ├── urls.py         # 用户模块子路由
│   │   └── services.py     # 复杂的业务逻辑（如JWT生成）
│   │
│   ├── communities/        # 社群模块
│   │   ├── models.py       # 社群、社群成员模型
│   │   ├── serializers.py
│   │   ├── views.py
│   │   └── urls.py
│   │
│   ├── events/             # 活动模块
│   │   # ... 结构同上
│   │
│   ├── posts/              # 信息发布（动态）模块
│   │   # ... 结构同上
│   │
│   ├── interactions/       # 线上互动空间模块
│   │   # ... 结构同上
│   │
│   └── notifications/      # 通知模块
│       # ... 结构同上
│
└── static/                 # 静态文件（开发阶段）
```

---

#### 2. 前端工程结构 (frontend/)

前端使用 `create-react-app` 初始化，并采用按功能（feature）组织的模块化结构。

```
frontend/
├── Dockerfile              # 前端服务的 Docker 配置文件 (用于生产构建)
├── package.json            # Node.js 依赖管理
├── public/                 # 公共文件（index.html, favicon.ico）
├── src/
│   ├── api/                # API 请求服务（如 axios 实例和各模块的 API 调用）
│   │   ├── auth.js
│   │   ├── communities.js
│   │   └── index.js
│   │
│   ├── assets/             # 静态资源（图片、字体、CSS）
│   │
│   ├── components/         # 可复用的 UI 组件（如 Button, Card, Input, Modal）
│   │   └── common/
│   │
│   ├── features/           # 按功能划分的模块（包含组件、Hooks 和状态）
│   │   ├── auth/           # 认证功能（登录、注册页面及逻辑）
│   │   ├── community/      # 社群功能（列表、详情、搜索组件）
│   │   ├── event/          # 活动功能
│   │   └── notification/   # 通知中心
│   │
│   ├── hooks/              # 自定义 Hooks（如 useAuth, useApi）
│   │
│   ├── pages/              # 页面级组件（组合 features 中的组件构成完整页面）
│   │   ├── HomePage.js
│   │   ├── LoginPage.js
│   │   ├── ProfilePage.js
│   │   └── ...
│   │
│   ├── routes/             # 路由配置
│   │   └── AppRouter.js
│   │
│   ├── store/              # 全局状态管理（Redux Toolkit / Zustand）
│   │
│   ├── utils/              # 工具函数
│   │
│   ├── App.js              # 应用根组件
│   └── index.js            # 应用入口
│
└── nginx.conf              # Nginx 配置文件（用于生产部署）
```

---

### 第二部分：系统设计文档

以下是根据您的 PRD 和上述工程结构编写的系统设计文档。

---

## Uni Hub 系统设计文档 (SDD)

**版本: 1.0**
**日期: 2025-07-12**

### 1. 概述

本文档旨在为 **Uni Hub** 项目提供全面的技术设计方案。该方案基于 PRD 中定义的需求，采用前后端分离的现代 Web 架构，并为系统的安全性、可扩展性和可维护性提供具体实现路径。

### 2. 系统架构

#### 2.1. 整体架构图

系统采用经典的前后端分离架构，通过容器化技术进行部署。

```
+----------------+      +---------------------+      +------------------------+
|   Web Browser  | <--> |  React Frontend     | <--> |  Django REST Backend   |
| (User)         |      |  (Container)        |      |  (Container)           |
+----------------+      +----------+----------+      +-----------+------------+
                                   |                           |
                            (HTTP/S Requests)                  | (SQL Queries)
                                   |                           |
                      +------------v------------+      +---------v----------+
                      | Reverse Proxy (Nginx)   |      |  PostgreSQL DB     |
                      | (Optional, for Prod)    |      |  (Container)       |
                      +-------------------------+      +--------------------+
```

- **用户端 (Client)**: 用户通过 Web 浏览器访问 React 前端应用。
- **前端 (Frontend)**: React 应用负责 UI 渲染和用户交互，通过 RESTful API 与后端通信。
- **后端 (Backend)**: Django + DRF 应用提供业务逻辑和数据接口，负责数据处理和持久化。
- **数据库 (Database)**: PostgreSQL 数据库存储所有应用数据。
- **容器化 (Containerization)**: 所有服务（前端、后端、数据库）都运行在独立的 Docker 容器中，由 Docker Compose 进行编排。

#### 2.2. 技术选型

| 领域 | 技术 | 理由 |
| :--- | :--- | :--- |
| **后端** | Python Django + Django REST Framework (DRF) | 开发效率高，生态成熟，拥有强大的 ORM 和内置安全特性。DRF 是构建 RESTful API 的业界标准。 |
| **前端** | React | 组件化开发模式提升了代码复用性和可维护性，庞大的社区和生态系统提供了丰富的解决方案。 |
| **数据库** | PostgreSQL | 功能强大的开源关系型数据库，支持复杂查询和 JSONB 等高级数据类型，性能稳定可靠。 |
| **认证方案** | JWT (JSON Web Token) | 无状态认证机制，非常适合前后端分离及分布式架构。可与 OAuth2 结合使用。 |
| **部署** | Docker / Docker Compose | 实现环境一致性，简化部署流程，便于实现水平扩展和持续集成/持续部署（CI/CD）。 |

### 3. 模块设计与核心功能实现

#### 3.1. 后端模块 (`apps/`)

1.  **用户模块 (`users`)**
    *   **功能**: 处理用户注册、登录、注销、密码修改和个人资料管理。
    *   **核心实现**: 使用 Django 内置 User 模型进行扩展。通过 DRF-SimpleJWT 库实现 JWT 的签发与验证。API 视图将使用 `IsAuthenticated` 权限进行保护。

2.  **社群模块 (`communities`)**
    *   **功能**: 支持用户创建、搜索、加入、退出社群。社群管理员可以管理成员。
    *   **核心实现**: `Community` 模型与 `User` 模型建立多对多关系（通过 `CommunityMember` 中间表），以记录成员和其角色（如 admin, member）。

3.  **活动模块 (`events`)**
    *   **功能**: 社群可以发布活动，用户可以浏览、筛选和报名参加活动。
    *   **核心实现**: `Event` 模型与 `Community` 模型建立外键关联。

4.  **信息发布模块 (`posts`)**
    *   **功能**: 用户可以发布动态（文本、图片），并按时间线或社群进行筛选。
    *   **核心实现**: `Post` 模型与 `User` 模型建立外键关联，记录作者。

5.  **通知模块 (`notifications`)**
    *   **功能**: 当有特定事件发生时（如被邀请加入社群、活动即将开始），向用户推送通知。
    *   **核心实现**: 创建 `Notification` 模型。通过 Django Signals 在特定动作（如创建 `CommunityMember` 记录）后触发通知的创建。提供一个 API (`/api/notifications/`) 让前端轮询或通过 WebSocket 推送。

#### 3.2. 数据库设计 (E-R 模型)

- **User**: `id`, `username`, `email`, `password`, `first_name`, `last_name`
- **Profile**: `user_id` (1-to-1 to User), `bio`, `avatar`, `major`
- **Community**: `id`, `name`, `description`, `creator_id` (FK to User)
- **CommunityMember** (M2M between User and Community): `user_id`, `community_id`, `role`, `join_date`
- **Event**: `id`, `title`, `description`, `start_time`, `location`, `community_id` (FK to Community)
- **EventParticipant** (M2M between User and Event): `user_id`, `event_id`, `registration_date`
- **Post**: `id`, `content`, `author_id` (FK to User), `community_id` (FK to Community, nullable), `created_at`

### 4. API 接口设计 (RESTful API)

API 将遵循 RESTful 设计原则，使用名词表示资源，使用 HTTP 动词表示操作。所有 API 路径前缀为 `/api/v1/`。

#### 4.1. 认证接口

- `POST /api/v1/users/register/`: 用户注册。
- `POST /api/v1/token/`: 用户登录，获取 JWT Access 和 Refresh Token。
- `POST /api/v1/token/refresh/`: 使用 Refresh Token 获取新的 Access Token。

#### 4.2. 示例接口

- **获取社群列表**: `GET /api/v1/communities/`
    - 支持过滤: `?search=robotics`
- **创建社群**: `POST /api/v1/communities/`
    - **Request Body**: `{ "name": "...", "description": "..." }`
    - **Headers**: `Authorization: Bearer <access_token>`
- **获取特定社群信息**: `GET /api/v1/communities/{id}/`
- **加入社群**: `POST /api/v1/communities/{id}/join/`
- **获取社群内的活动**: `GET /api/v1/communities/{id}/events/`

### 5. 非功能性需求实现策略

- **性能 (Performance)**
    - **后端**: 优化数据库查询（使用 `select_related` 和 `prefetch_related` 减少查询次数），对常用查询字段建立索引。引入缓存（如 Redis）缓存热点数据。
    - **前端**: 使用代码分割（Code Splitting）减少初始加载体积。对图片等静态资源进行压缩。
    - **目标**: 页面响应时间 < 2 秒，支持 500+ 并发用户。

- **可扩展性 (Scalability)**
    - **无状态后端**: 后端服务设计为无状态，不保存会话信息（使用 JWT），便于通过增加容器实例进行水平扩展。
    - **模块化设计**: 当前的 App 结构为未来拆分成独立的微服务奠定了基础。

- **安全性 (Security)**
    - **认证与授权**: 使用 JWT 保护 API 接口。在 DRF 中使用权限类（Permission Classes）控制用户对不同资源的访问权限。
    - **数据传输**: 生产环境强制使用 HTTPS。
    - **输入验证**: DRF Serializers 会对所有传入数据进行严格验证，防止 SQL 注入等攻击。
    - **Django 内置安全**: 自动启用 CSRF 防护、XSS 保护等。

- **可用性 (Usability)**
    - **直观界面**: 前端将遵循一致的设计语言，确保组件和布局的直观性。
    - **响应式设计**: 确保在不同尺寸的设备（桌面、平板、手机）上都有良好的用户体验。

